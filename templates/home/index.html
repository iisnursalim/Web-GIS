{% extends "home/base.html" %}
{% load static %}
{% load leaflet_tags %}

{% block Title %}
Sistem Informasi Sarana dan Prasarana Wilayah Kabupaten Sidrap
{% endblock Title %}

{% block Leaflet_css %}

{% endblock Leaflet_css %}

{% block Heading %}

{% endblock Heading %}

{% block Contents %}
<script>
	function map_layers(map, option) {
		// Add base map tiles from OpenstreetMap
		var street = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
			maxZoom: 20,
			id: 'mapbox/streets-v11',
			tileSize: 512,
			zoomOffset: -1,
			accessToken: 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw'
		});
		street.addTo(map);
		var satellite = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
			maxZoom: 20,
			id: 'mapbox/satellite-streets-v11',
			tileSize: 512,
			zoomOffset: -1,
			accessToken: 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NDg1bDA1cjYzM280NHJ5NzlvNDMifQ.d6e-nNyBDtmQCVwVNivz7A'
		});

		// Add data map from database with using L.GeoJSON.AJAX plugin.

		var Jalan = new L.GeoJSON.AJAX("{% url 'maps:data_jalan' %}", {
			onEachFeature: function (feature, layer) {
				layer.bindPopup('<table style="width:100%"> <tr><th>JALAN</th></tr> <tr><td>Klasifikasi Jalan</td> <td>: ' + feature.properties.kelas_jln + '</td></tr> <tr><td>Panjang (km)</td> <td>: ' + feature.properties.panjang + '</td></tr></table>');
			},
			style: function (feature) {
				value = feature.properties.kelas_jln;
				function getColor(d) {
					return d == 'Jalan Arteri' ? '#A20A0A' :
						d == 'Jalan Kolektor' ? '#92817A' :
							d == 'Jalan Lokal' ? '#A53197' :
								d == 'Jalan Setapak' ? '#321F28' :
									d == 'Jalan Lain' ? '#7E7474' : '#59FD02';
				}
				return {
					weight: 1,
					color: getColor(value),
				};
			},
		});


		var JalanPoint = new L.GeoJSON.AJAX("{% url 'maps:data_kondisi_jalan' %}", {
			onEachFeature: function (feature, layer) {
				layer.bindPopup('<table style="width:100%"> <tr><td>Surveyor</td> <td>: ' + feature.properties.surveyor + '</td></tr> <tr><td>Tanggal Survei</td> <td>: ' + feature.properties.waktu_surv + '</td></tr> <tr><td>Nomor Ruas</td> <td>: ' + feature.properties.nomor_ruas + '</td></tr> <tr><td>Nama Jalan</td> <td>: ' + feature.properties.nama_jalan + '</td></tr> <tr><td>Panjang</td> <td>: ' + feature.properties.panjang + '</td></tr> <tr><td>Lebar</td> <td>: ' + feature.properties.lebar + '</td></tr> <tr><td>TPP</td> <td>: ' + feature.properties.tpp + '</td></tr> <tr><td>TPU</td> <td>: ' + feature.properties.tpu + '</td></tr> <tr><td>LHR</td> <td>: ' + feature.properties.lhr + '</td></tr> <tr><td>Klasifikasi</td> <td>: ' + feature.properties.klasifikas + '</td></tr> <tr><td>Status Administrasi</td> <td>: ' + feature.properties.status_adm + '</td></tr> <tr><td>Tipe Permukaan</td> <td>: ' + feature.properties.tipe_permu + '</td></tr> <tr><td>Kondisi Jalan</td> <td>: ' + feature.properties.kondisi_ja + '</td></tr> <tr><td>Hambatan</td> <td>: ' + feature.properties.hambatan + '</td></tr> </table>');
			},
		});

		var Jembatan = new L.GeoJSON.AJAX("{% url 'maps:data_jembatan' %}", {
			onEachFeature: function (feature, layer) {
				layer.bindPopup('<table style="width:100%"> <tr><td>Surveyor</td> <td>: ' + feature.properties.surveyor + '</td></tr> <tr><td>Tanggal Survei</td> <td>: ' + feature.properties.waktu_surv + '</td></tr> <tr><td>Nama</td> <td>: ' + feature.properties.nama + '</td></tr> <tr><td>Kode Jembatan</td> <td>: ' + feature.properties.no_kode + '</td></tr> <tr><td>Tipe Penyebrangan</td> <td>: ' + feature.properties.tipe_sebra + '</td></tr> <tr><td>Jenis Jembatan</td> <td>: ' + feature.properties.jenis_jemb + '</td></tr> <tr><td>Panjang</td> <td>: ' + feature.properties.panjang + '</td></tr> <tr><td>Lebar</td> <td>: ' + feature.properties.lebar + '</td></tr> <tr><td>Jumlah Bentang</td> <td>: ' + feature.properties.jml_bentan + '</td></tr> <tr><td>Kondisi Jembatan</td> <td>: ' + feature.properties.kondisi + '</td></tr> </table>');
			},
		});

		var Kesehatan = new L.GeoJSON.AJAX("{% url 'maps:data_kesehatan' %}", {
			onEachFeature: function (feature, layer) {
				layer.bindPopup('<table style="width:100%"> <tr><td>Surveyor</td> <td>: ' + feature.properties.surveyor + '</td></tr> <tr><td>Tanggal Survei</td> <td>: ' + feature.properties.waktu_surv + '</td></tr> <tr><td>Nama</td> <td>: ' + feature.properties.nama + '</td></tr> <tr><td>Alamat</td> <td>: ' + feature.properties.alamat + '</td></tr> <tr><td>Jenis Fasilitas Kesehatan</td> <td>: ' + feature.properties.jenis + '</td></tr> <tr><td>Kondisi</td> <td>: ' + feature.properties.kondisi + '</td></tr> </table>');
			},
		});

		var Drainase = new L.GeoJSON.AJAX("{% url 'maps:data_drainase' %}", {
			onEachFeature: function (feature, layer) {
				layer.bindPopup('<table style="width:100%"> <tr><td>Surveyor</td> <td>: ' + feature.properties.surveyor + '</td></tr> <tr><td>Tanggal Survei</td> <td>: ' + feature.properties.waktu_surv + '</td></tr>  <tr><td>Kode Drainase</td> <td>: ' + feature.properties.no_kode + '</td></tr> <tr><td>RPRU</td> <td>: ' + feature.properties.rpru + '</td></tr> <tr><td>Kemiringan</td> <td>: ' + feature.properties.kemiringan + '</td></tr> <tr><td>Lebar Saluran</td> <td>: ' + feature.properties.lebar_salu + '</td></tr> <tr><td>Kondisi Drainsase</td> <td>: ' + feature.properties.kondisi + '</td></tr> </table>');
			},
		});

		var Pendidikan = new L.GeoJSON.AJAX("{% url 'maps:data_pendidikan' %}", {
			onEachFeature: function (feature, layer) {
				layer.bindPopup('<table style="width:100%"> <tr><td>Surveyor</td> <td>: ' + feature.properties.surveyor + '</td></tr> <tr><td>Tanggal Survei</td> <td>: ' + feature.properties.waktu_surv + '</td></tr> <tr><td>Nama Sekolah</td> <td>: ' + feature.properties.nama + '</td></tr> <tr><td>Alamat</td> <td>: ' + feature.properties.alamat + '</td></tr> <tr><td>Jenjang</td> <td>: ' + feature.properties.jenjang + '</td></tr></table>');
			},
		});

		var Kab_Sidrap = new L.GeoJSON.AJAX("{% url 'maps:data_kab_sidrap' %}", {
			onEachFeature: function (feature, layer) {
				layer.bindPopup('<table style="width:100%"> <tr><th>KABUPATEN SIDRAP</th></tr> <tr><td>Desa</td> <td>: ' + feature.properties.desa + '</td></tr> <tr><td>Kecamatan</td> <td>: ' + feature.properties.kecamatan + '</td></tr></table>');
			},
			style: function (feature) {
				value = feature.properties.kecamatan;
				function getColor(d) {
					return d == 'PITU RIASE' ? '#800026' :
						d == 'PITU RIAWA' ? '#bd0026' :
							d == 'KULO' ? '#e31a1c' :
								d == 'BARANTI' ? '#fc4e2a' :
									d == 'MARITENGNGAE' ? '#fd8d3c' :
										d == 'DUAPITUE' ? '#feb24c' :
											d == 'PANCA LAUTANG' ? '#fed976' :
												d == 'WATANG PULU' ? '#ffeda0' :
													d == 'TELLULIMPO E' ? '#fc9272' :
														d == 'PANCA RIJANG' ? '#ef3b2c' :
															d == 'WATANG SIDENRENG' ? '#67000d' : '#ffffcc';
				}
				return {
					fillColor: getColor(value),
					fillOpacity: 0.8,
					weight: 2,
					opacity: 0.3,
					color: 'grey',
					Dashboard: '3',
				};
			},
		});
		Kab_Sidrap.addTo(map);

		// Add control layers
		var baseLayers = {
			"Streets": street,
			"Satellite": satellite
		}
		var overlayMaps = {
			"Layers": {
				"Jalan": Jalan,
				"Kondisi Jalan": JalanPoint,
				"Kondisi Jembatan": Jembatan,
				"Prasarana Kesehatan": Kesehatan,
				"Kondisi Drainase": Drainase,
				"Sarana Pendidikan": Pendidikan,
				"Kabupaten Sidrap": Kab_Sidrap
			}
		};
		L.control.groupedLayers(baseLayers, overlayMaps).addTo(map);

	}

</script>

{% leaflet_map "gis" callback="window.map_layers" %}
{% endblock Contents %}